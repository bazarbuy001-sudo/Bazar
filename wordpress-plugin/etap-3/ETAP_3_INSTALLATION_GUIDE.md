# –≠–¢–ê–ü 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Chat –∏ Telegram –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

**–¶–µ–ª—å:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å endpoints –¥–ª—è —á–∞—Ç–∞ –∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π mock —Ä–µ–∂–∏–º–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
2. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-—Ñ–∞–π–ª–æ–≤)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Ä–µ–∂–∏–º–æ–≤-—Ä–∞–±–æ—Ç—ã)
4. [–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø–ª–∞–≥–∏–Ω–µ](#–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-–≤-–ø–ª–∞–≥–∏–Ω–µ)
5. [–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)](#–º–∏–≥—Ä–∞—Ü–∏—è-–±–¥-–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
6. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-telegram-–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
7. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
8. [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## üìã –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:
- ‚úÖ WordPress –ø–ª–∞–≥–∏–Ω `bazarbuy-cabinet` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ö–ª–∞—Å—Å `Bazarbuy_Response` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ø–ª–∞–≥–∏–Ω–µ
- ‚úÖ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–≠–¢–ê–ü 1)

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:
- ‚è≥ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º–∞)
- ‚è≥ Telegram Bot —Å–æ–∑–¥–∞–Ω (–¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)

---

## üîß –£–°–¢–ê–ù–û–í–ö–ê –§–ê–ô–õ–û–í

### –®–∞–≥ 1: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –≤ –≤–∞—à –ø–ª–∞–≥–∏–Ω:

**1. Chat Controller:**
```
wordpress-plugin/etap-3/includes/api/class-chat-controller.php
‚Üì
wp-content/plugins/bazarbuy-cabinet/includes/api/class-chat-controller.php
```

**2. Telegram Controller:**
```
wordpress-plugin/etap-3/includes/api/class-telegram-controller.php
‚Üì
wp-content/plugins/bazarbuy-cabinet/includes/api/class-telegram-controller.php
```

**3. Chat DB Abstraction:**
```
wordpress-plugin/etap-3/includes/db/class-chat-db.php
‚Üì
wp-content/plugins/bazarbuy-cabinet/includes/db/class-chat-db.php
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
wp-content/plugins/bazarbuy-cabinet/
‚îú‚îÄ‚îÄ bazarbuy-cabinet.php
‚îú‚îÄ‚îÄ includes/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ class-chat-controller.php        ‚Üê –ù–û–í–´–ô
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ class-telegram-controller.php    ‚Üê –ù–û–í–´–ô
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ class-user-controller.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ db/
‚îÇ       ‚îî‚îÄ‚îÄ class-chat-db.php                ‚Üê –ù–û–í–´–ô
‚îî‚îÄ‚îÄ ...
```

---

## ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ê –†–ï–ñ–ò–ú–û–í –†–ê–ë–û–¢–´

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç **–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î –∏ Telegram**:

- **Chat:** –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ WordPress transients (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
- **Telegram:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `error_log`

**–ù–∏—á–µ–≥–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏".

---

### –†–µ–∂–∏–º –ø—Ä–æ–¥–∞–∫—à–Ω (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ)

–î–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º –¥–æ–±–∞–≤—å—Ç–µ –≤ `wp-config.php`:

```php
// –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ë–î –¥–ª—è —á–∞—Ç–∞
define('BAZARBUY_CHAT_USE_DB', true);

// –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Telegram
define('BAZARBUY_TELEGRAM_ENABLED', true);

// Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
define('BAZARBUY_TELEGRAM_BOT_TOKEN', '1234567890:ABCdefGHIjklMNOpqrsTUVwxyz');

// Telegram Chat ID (ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
define('BAZARBUY_TELEGRAM_CHAT_ID', '-1001234567890');
```

**–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç:
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ë–î)
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ WordPress (–æ—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à)

---

## üîå –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –í –ü–õ–ê–ì–ò–ù–ï

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ñ–∞–π–ª—ã –≤ –≥–ª–∞–≤–Ω–æ–º —Ñ–∞–π–ª–µ –ø–ª–∞–≥–∏–Ω–∞

–û—Ç–∫—Ä–æ–π—Ç–µ **`bazarbuy-cabinet.php`** –∏ –Ω–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤:

```php
// –ù–ê–ô–¢–ò:
require_once plugin_dir_path(__FILE__) . 'includes/api/class-user-controller.php';

// –î–û–ë–ê–í–ò–¢–¨ –ü–û–°–õ–ï:
require_once plugin_dir_path(__FILE__) . 'includes/api/class-chat-controller.php';
require_once plugin_dir_path(__FILE__) . 'includes/api/class-telegram-controller.php';
require_once plugin_dir_path(__FILE__) . 'includes/db/class-chat-db.php';
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

–ù–∞–π–¥–∏—Ç–µ –º–µ—Å—Ç–æ, –≥–¥–µ —Å–æ–∑–¥–∞—é—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä—ã:

```php
// –ù–ê–ô–¢–ò:
$user_controller = new Bazarbuy_User_Controller();

// –î–û–ë–ê–í–ò–¢–¨ –ü–û–°–õ–ï:
$chat_controller = new Bazarbuy_Chat_Controller();
$telegram_controller = new Bazarbuy_Telegram_Controller();
```

### –®–∞–≥ 3: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã

–ù–∞–π–¥–∏—Ç–µ —Ö—É–∫ `rest_api_init`:

```php
// –ù–ê–ô–¢–ò:
add_action('rest_api_init', function() use ($user_controller) {
    $user_controller->register_routes();
});

// –ò–ó–ú–ï–ù–ò–¢–¨ –ù–ê:
add_action('rest_api_init', function() use ($user_controller, $chat_controller, $telegram_controller) {
    $user_controller->register_routes();
    $chat_controller->register_routes();           // ‚Üê –ù–û–í–´–ô
    $telegram_controller->register_routes();       // ‚Üê –ù–û–í–´–ô
});
```

**–ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞:**

```php
public function register_routes() {
    $this->user_controller->register_routes();
    $this->chat_controller->register_routes();      // ‚Üê –ù–û–í–´–ô
    $this->telegram_controller->register_routes();  // ‚Üê –ù–û–í–´–ô
}
```

---

## üóÑÔ∏è –ú–ò–ì–†–ê–¶–ò–Ø –ë–î (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)

### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î?

–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç–µ—Å—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º (`BAZARBUY_CHAT_USE_DB = true`).

–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ë–î –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è WordPress transients.

---

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ SQL

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª:
```
wordpress-plugin/etap-3/migrations/001_create_chat_tables.sql
```

**–ó–∞–º–µ–Ω–∏—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å —Ç–∞–±–ª–∏—Ü:**
```sql
-- –ë–´–õ–û:
CREATE TABLE `wp_bazarbuy_chat_messages` ...

-- –î–û–õ–ñ–ù–û –ë–´–¢–¨ (–µ—Å–ª–∏ –≤–∞—à –ø—Ä–µ—Ñ–∏–∫—Å wpabc_):
CREATE TABLE `wpabc_bazarbuy_chat_messages` ...
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å –≤ `wp-config.php`:**
```php
$table_prefix = 'wpabc_';  // ‚Üê –í–∞—à –ø—Ä–µ—Ñ–∏–∫—Å
```

---

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ phpMyAdmin / Adminer

1. –û—Ç–∫—Ä–æ–π—Ç–µ phpMyAdmin
2. –í—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö WordPress
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "SQL"
4. –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `001_create_chat_tables.sql`
5. –ù–∞–∂–º–∏—Ç–µ "–í—ã–ø–æ–ª–Ω–∏—Ç—å"

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ WP-CLI

```bash
wp db query < migrations/001_create_chat_tables.sql
```

#### –í–∞—Ä–∏–∞–Ω—Ç –í: –ß–µ—Ä–µ–∑ MySQL –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

```bash
mysql -u username -p database_name < migrations/001_create_chat_tables.sql
```

---

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã

```bash
# –ß–µ—Ä–µ–∑ WP-CLI:
wp db query "SHOW TABLES LIKE '%bazarbuy_chat_messages%'"

# –ß–µ—Ä–µ–∑ MySQL:
mysql -u username -p -e "SHOW TABLES LIKE '%bazarbuy_chat_messages%'" database_name
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** –¢–∞–±–ª–∏—Ü–∞ `wp_bazarbuy_chat_messages` —Å–æ–∑–¥–∞–Ω–∞.

---

### –®–∞–≥ 4: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ mock —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ mock —Ä–µ–∂–∏–º –∏ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î, —Å–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:

```php
<?php
// migrate-mock-to-db.php (–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø–ª–∞–≥–∏–Ω–∞)

require_once('../../../wp-load.php');

global $wpdb;
$table_name = $wpdb->prefix . 'bazarbuy_chat_messages';

// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ transients —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
$transient_keys = $wpdb->get_col(
    "SELECT option_name FROM {$wpdb->options} 
     WHERE option_name LIKE '_transient_bazarbuy_chat_mock_%'"
);

foreach ($transient_keys as $key) {
    $user_id = str_replace('_transient_bazarbuy_chat_mock_', '', $key);
    $messages = get_transient('bazarbuy_chat_mock_' . $user_id);
    
    if (!$messages) continue;
    
    foreach ($messages as $msg) {
        $wpdb->insert($table_name, [
            'user_id' => $msg['user_id'],
            'order_id' => $msg['order_id'],
            'sender' => $msg['sender'],
            'message' => $msg['message'],
            'status' => $msg['status'],
            'created_at' => $msg['created_at'],
            'updated_at' => $msg['updated_at']
        ]);
    }
    
    echo "Migrated " . count($messages) . " messages for user {$user_id}\n";
}

echo "Migration complete!\n";
```

**–í–∞–∂–Ω–æ:** –£–¥–∞–ª–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è!

---

## üì± –ù–ê–°–¢–†–û–ô–ö–ê TELEGRAM (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å Telegram Bot

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ **Bot Token** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`)

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å Chat ID

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –õ–∏—á–Ω—ã–π —á–∞—Ç

1. –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ–º—É –±–æ—Ç—É –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
   ```
   https://api.telegram.org/bot–í–ê–®_BOT_TOKEN/getUpdates
   ```
3. –ù–∞–π–¥–∏—Ç–µ `"chat":{"id":123456789}` ‚Äî —ç—Ç–æ –≤–∞—à Chat ID

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
2. –°–¥–µ–ª–∞–π—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
4. –û—Ç–∫—Ä–æ–π—Ç–µ:
   ```
   https://api.telegram.org/bot–í–ê–®_BOT_TOKEN/getUpdates
   ```
5. –ù–∞–π–¥–∏—Ç–µ `"chat":{"id":-1001234567890}` (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –¥–ª—è –≥—Ä—É–ø–ø)

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –≤ wp-config.php

```php
define('BAZARBUY_TELEGRAM_ENABLED', true);
define('BAZARBUY_TELEGRAM_BOT_TOKEN', '–í–ê–®_BOT_TOKEN');
define('BAZARBUY_TELEGRAM_CHAT_ID', '–í–ê–®_CHAT_ID');
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoints

```bash
# GET /chat/history (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞ ‚Üí 401)
curl -X GET https://–≤–∞—à-–¥–æ–º–µ–Ω.com/wp/wp-json/cabinet/v1/chat/history

# POST /chat/send (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞ ‚Üí 401)
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.com/wp/wp-json/cabinet/v1/chat/send \
  -H "Content-Type: application/json" \
  -d '{"message":"–¢–µ—Å—Ç"}'

# POST /telegram/notify (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞ ‚Üí 401)
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.com/wp/wp-json/cabinet/v1/telegram/notify \
  -H "Content-Type: application/json" \
  -d '{"type":"new_message","text":"–¢–µ—Å—Ç"}'
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** `401 Unauthorized` –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

---

### –¢–µ—Å—Ç 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å —Ç–æ–∫–µ–Ω–æ–º)

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å JWT —Ç–æ–∫–µ–Ω
TOKEN=$(curl -s -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.com/wp/wp-json/cabinet/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password"}' \
  | grep -o '"token":"[^"]*' | cut -d'"' -f4)

# 2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.com/wp/wp-json/cabinet/v1/chat/send \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
    "orderId": "123"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (200 OK):**
```json
{
  "success": true,
  "data": {
    "id": "mock_1234567890_5678",
    "status": "pending"
  }
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ mock —Ä–µ–∂–∏–º–∞:**
- –í –ª–æ–≥–∞—Ö WordPress (`wp-content/debug.log`) –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
  ```
  [Bazarbuy_Chat_DB Mock] –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: {...}
  ```

---

### –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

```bash
curl -X GET "https://–≤–∞—à-–¥–æ–º–µ–Ω.com/wp/wp-json/cabinet/v1/chat/history?limit=10&offset=0" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (200 OK):**
```json
{
  "success": true,
  "data": [
    {
      "id": "mock_1234567890_5678",
      "from": "client",
      "text": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
      "status": "pending",
      "createdAt": "2025-01-10T12:00:00+00:00",
      "orderId": "123"
    }
  ]
}
```

---

### –¢–µ—Å—Ç 4: Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (mock —Ä–µ–∂–∏–º)

```bash
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.com/wp/wp-json/cabinet/v1/telegram/notify \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "new_message",
    "clientId": "BB-00001",
    "clientName": "Test User",
    "text": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
    "orderId": "123"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (200 OK):**
```json
{
  "success": true,
  "data": {
    "success": true
  }
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ mock —Ä–µ–∂–∏–º–∞:**
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
  ```
  [Bazarbuy_Telegram Mock] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: üí¨ –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫—Ä—ã–ª —á–∞—Ç...
  ```

---

### –¢–µ—Å—Ç 5: Rate limiting

–û—Ç–ø—Ä–∞–≤—å—Ç–µ **11 —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥—Ä—è–¥** –≤ —Ç–µ—á–µ–Ω–∏–µ –º–∏–Ω—É—Ç—ã:

```bash
for i in {1..11}; do
  curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.com/wp/wp-json/cabinet/v1/chat/send \
    -H "Authorization: Bearer $TOKEN" \
    -H "Content-Type: application/json" \
    -d "{\"message\":\"–°–æ–æ–±—â–µ–Ω–∏–µ $i\"}"
  echo ""
done
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- –ü–µ—Ä–≤—ã–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π: `200 OK`
- 11-–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: `429 Too Many Requests`

---

### –¢–µ—Å—Ç 6: –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

```bash
# –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–±–æ–ª—å—à–µ 2000 —Å–∏–º–≤–æ–ª–æ–≤)
LONG_MESSAGE=$(python3 -c "print('A' * 2001)")
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.com/wp/wp-json/cabinet/v1/chat/send \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"message\":\"$LONG_MESSAGE\"}"
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** `400 Bad Request` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ.

---

## ‚ö†Ô∏è –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú

### –ü—Ä–æ–±–ª–µ–º–∞ 1: 404 Not Found –¥–ª—è endpoints

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `require_once` –¥–æ–±–∞–≤–ª–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `register_routes()` –≤—ã–∑–≤–∞–Ω
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–±—Ä–æ—Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫: `wp rewrite flush`

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Class 'Bazarbuy_Response' not found

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª–∞—Å—Å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ø–ª–∞–≥–∏–Ω–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–∫–ª—é—á—ë–Ω –ø–µ—Ä–≤—ã–º)

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Mock —Ä–µ–∂–∏–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `wp-config.php`:
   ```php
   // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–∏—Ö —Å—Ç—Ä–æ–∫ –ù–ï–¢:
   // define('BAZARBUY_CHAT_USE_DB', true);
   // define('BAZARBUY_TELEGRAM_ENABLED', true);
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `wp-content/debug.log`

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç (–≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º–µ)

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `wp-config.php`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Bot Token –∏ Chat ID
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `wp-content/debug.log`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API Telegram:
   ```bash
   curl https://api.telegram.org/bot–í–ê–®_BOT_TOKEN/getMe
   ```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –£–°–¢–ê–ù–û–í–ö–ò

- [ ] –§–∞–π–ª—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –§–∞–π–ª—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã —á–µ—Ä–µ–∑ `require_once`
- [ ] –≠–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ú–∞—Ä—à—Ä—É—Ç—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Endpoints –¥–æ—Å—Ç—É–ø–Ω—ã (401 –±–µ–∑ —Ç–æ–∫–µ–Ω–∞)
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç (mock —Ä–µ–∂–∏–º)
- [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (mock —Ä–µ–∂–∏–º)
- [ ] Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç (10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É)
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] SQL –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ë–î)
- [ ] Telegram –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–æ–¥–∞–∫—à–Ω)

---

## üìä –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:**
   - –û—Ç–∫—Ä—ã—Ç—å –∫–∞–±–∏–Ω–µ—Ç
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

2. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω (–∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ):**
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram Bot
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `wp-config.php`

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –ë–î
   - –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

**–ì–æ—Ç–æ–≤–æ! –≠–¢–ê–ü 3 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. üöÄ**


