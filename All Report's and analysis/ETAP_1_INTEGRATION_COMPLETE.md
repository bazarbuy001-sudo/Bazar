# ‚úÖ –≠–¢–ê–ü 1 –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –ó–ê–í–ï–†–®–Å–ù

**–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2026-01-XX  
**–¶–µ–ª—å:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å WordPress REST API

---

## üìã –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### ‚úÖ 1. –ò–∑–º–µ–Ω—ë–Ω endpoint –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª:** `frontend/cabinet/cabinet-api.js`  
**–°—Ç—Ä–æ–∫–∞:** 32

**–ë—ã–ª–æ:**
```javascript
authCheck: '/auth/check',
```

**–°—Ç–∞–ª–æ:**
```javascript
authCheck: '/auth/me',
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å WordPress REST API —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º.

---

### ‚úÖ 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ 401 (–∏—Å—Ç–µ—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞)

**–§–∞–π–ª:** `frontend/cabinet/cabinet-api.js`  
**–°—Ç—Ä–æ–∫–∞:** –ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 265

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```javascript
if (!response.ok) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ 401 (—Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫) - –ö–†–ò–¢–ò–ß–ù–û –î–õ–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò
    if (response.status === 401) {
        // –û—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω
        setAuthToken(null);
        
        // –≠–º–∏—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ –¥–ª—è CabinetStore
        window.dispatchEvent(new CustomEvent('cabinet:auth-expired'));
        
        const errorData = await response.json().catch(() => ({}));
        throw new Error(errorData.message || errorData.error?.message || '–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.');
    }
    
    const errorData = await response.json().catch(() => ({}));
    throw new Error(errorData.message || `HTTP ${response.status}`);
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏, —É–ª—É—á—à–µ–Ω–Ω—ã–π UX.

---

### ‚úÖ 3. –û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ checkAuth() –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ WordPress

**–§–∞–π–ª:** `frontend/cabinet/cabinet-api.js`  
**–°—Ç—Ä–æ–∫–∞:** 489-521

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ WordPress: `{ success: false, error: {...} }`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä—è–º–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `{ id, email, ... }`
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç–µ–∫—É—â–∏–º —Ñ–æ—Ä–º–∞—Ç–æ–º: `{ isAuthenticated, user }`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback –Ω–∞ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Å WordPress API, —Ç–∞–∫ –∏ —Å mock-–¥–∞–Ω–Ω—ã–º–∏.

---

### ‚úÖ 4. –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è `cabinet:auth-expired`

**–§–∞–π–ª:** `frontend/cabinet/cabinet-store.js`  
**–°—Ç—Ä–æ–∫–∞:** –ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 1007

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```javascript
// –°–æ–±—ã—Ç–∏–µ: –∏—Å—Ç–µ—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞ (401 –æ—Ç API) - –ö–†–ò–¢–ò–ß–ù–û –î–õ–Ø UX
window.addEventListener('cabinet:auth-expired', () => {
    setState(s => ({
        ...s,
        client: { ...initialState.client },
        system: { ...s.system, error: '–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.' }
    }));
    emitEvent(EVENTS.AUTH_CHANGED, { isAuthenticated: false });
});
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏.

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ò

### ‚úÖ Mock-—Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Endpoint `/auth/me` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ `mockRequest()`
- ‚úÖ –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π `checkAuth()`
- ‚úÖ –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ endpoints –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### ‚úÖ –õ–∏–Ω—Ç–µ—Ä: –æ—à–∏–±–æ–∫ –Ω–µ—Ç
- ‚úÖ `frontend/cabinet/cabinet-api.js` ‚Äî –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ `frontend/cabinet/cabinet-store.js` ‚Äî –±–µ–∑ –æ—à–∏–±–æ–∫

### ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- ‚úÖ Mock-—Ä–µ–∂–∏–º –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ endpoints –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: Mock-—Ä–µ–∂–∏–º
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞–±–∏–Ω–µ—Ç–∞:
// 1. –ö–∞–±–∏–Ω–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
// 2. Mock-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
// 3. –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
```

### –¢–µ—Å—Ç 2: –°–æ–±—ã—Ç–∏–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
window.dispatchEvent(new CustomEvent('cabinet:auth-expired'));

// –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
// - –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å–±—Ä–æ—à–µ–Ω–æ
// - –ü–æ—è–≤–∏–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ: "–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞."
// - –°–æ–±—ã—Ç–∏–µ cabinet:auth-changed —ç–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å isAuthenticated: false
```

### –¢–µ—Å—Ç 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WordPress (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω)
```javascript
// –í cabinet-api.js —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
CONFIG.useMock = false;
CONFIG.baseURL = 'https://your-domain.com/wp/wp-json/cabinet/v1';

// –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
// - Endpoint /auth/me –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ /auth/check
// - –ü—Ä–∏ 401 —Ç–æ–∫–µ–Ω –æ—á–∏—â–∞–µ—Ç—Å—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ
```

---

## üìä –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´

1. ‚úÖ `frontend/cabinet/cabinet-api.js`
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ endpoint: `/auth/check` ‚Üí `/auth/me`
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ 401 –≤ `request()`
   - –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –≤ `checkAuth()`

2. ‚úÖ `frontend/cabinet/cabinet-store.js`
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è `cabinet:auth-expired`

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ 401
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å WordPress JWT —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ rate limiting (–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ WordPress)

### –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ WordPress:
- ‚è≥ –î–æ–±–∞–≤–∏—Ç—å `BAZARBUY_JWT_SECRET` –≤ `wp-config.php`
- ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É rate limiting
- ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –≠–¢–ê–ü 2: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î–æ–±–∞–≤–∏—Ç—å `/user/client` endpoint –≤ WordPress (–í–∞—Ä–∏–∞–Ω—Ç –ê)
- –ò–õ–ò –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å `getClient()` –¥–ª—è –¥–≤—É—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–í–∞—Ä–∏–∞–Ω—Ç –ë)

### –≠–¢–ê–ü 3: –ß–∞—Ç –∏ Telegram
- –°–æ–∑–¥–∞—Ç—å `class-chat-controller.php` –≤ WordPress
- –°–æ–∑–¥–∞—Ç—å `class-telegram-controller.php` –≤ WordPress
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å endpoints –≤ –ø–ª–∞–≥–∏–Ω–µ

---

## ‚úÖ –ò–¢–û–ì

**–≠–¢–ê–ü 1 –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!**

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤)
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å WordPress API (`/auth/me`)
- ‚úÖ –£—Å—Ç–æ–π—á–∏–≤–∞ –∫ –æ—à–∏–±–∫–∞–º (fallback –Ω–∞ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–≠–¢–ê–ü–´ 2 –∏ 3)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç mock-—Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –≠–¢–ê–ü–£ 2.**


