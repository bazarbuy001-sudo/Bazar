#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ –≤—Å–µ HTML —Ñ–∞–π–ª—ã

FRONTEND_DIR="/Users/bazarbuy/Desktop/fabric-store/frontend-legacy"
AUTOSAVE_SCRIPT='    <!-- ‚≠ê –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï –ö–ê–ñ–î–´–ï 10 –ú–ò–ù–£–¢ -->\n    <script src="js/utils/autosave.js"></script>'

echo "üîÑ –î–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ –≤—Å–µ HTML —Ñ–∞–π–ª—ã..."

# –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ HTML —Ñ–∞–π–ª—ã –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π
find "$FRONTEND_DIR" -name "*.html" | while read -r file; do
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    if grep -q "autosave.js" "$file"; then
        echo "‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫–∞–µ–º $file (–∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–∂–µ –µ—Å—Ç—å)"
        continue
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–π —Ç–µ–≥ </body>
    if grep -q "</body>" "$file"; then
        # –î–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ </body>
        sed -i '' "s|</body>|$AUTOSAVE_SCRIPT\n</body>|g" "$file"
        echo "‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ $(basename "$file")"
    else
        echo "‚ö†Ô∏è  –í —Ñ–∞–π–ª–µ $file –Ω–µ—Ç —Ç–µ–≥–∞ </body>"
    fi
done

echo "üéâ –ì–æ—Ç–æ–≤–æ! –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤–æ –≤—Å–µ HTML —Ñ–∞–π–ª—ã."