<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ - Bazar Buy</title>
    <link rel="stylesheet" href="cabinet/cabinet.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/product-popup.css">
    <link rel="stylesheet" href="css/megaMenu.css">
    <link rel="stylesheet" href="css/catalog-fallback.css">
    <link rel="stylesheet" href="css/mobile-fixes.css">
    <link rel="stylesheet" href="css/mobile-fixes-phase6.css">
    <!-- Phase 6: Viewport height utility (load early) -->
    <script type="module" src="js/utils/viewportHeight.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.cdnfonts.com/css/didot');

        :root {
            --primary-color: #1a1a1a;
            --accent-color: #d4a574;
            --background: #fafafa;
            --border-color: #e5e5e5;
            --text-primary: #2c2c2c;
            --text-secondary: #6b6b6b;
            --transition-speed: 0.3s;
            --transition-ease: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        html {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        /* ============================================
           HEADER - STICKY (–ª–∏–ø–∫–∞—è —à–∞–ø–∫–∞)
           CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —à–∞–ø–∫–∏
           ============================================ */
        .site-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: white;
            width: 100%;
            margin: 0;
            padding: 0;
            border: none;
            box-shadow: none;
            /* –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —à–∞–ø–∫–∏ */
            --header-primary-color: #1a1a1a;
            --header-accent-color: #d4a574;
            --header-border-color: #e5e5e5;
            --header-text-primary: #2c2c2c;
            --header-text-secondary: #6b6b6b;
        }

        /* –ò–∑–æ–ª—è—Ü–∏—è: –≤—Å–µ —Å—Ç–∏–ª–∏ –≤–Ω—É—Ç—Ä–∏ .site-header –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç */
        .site-header * {
            box-sizing: border-box;
        }

        .nav-container {
            max-width: 60% !important;
            width: 60% !important;
            margin: 0 auto !important;
            padding: 0 !important;
            border: none !important;
            box-shadow: none !important;
            background: transparent !important;
        }

        .header-sticky {
            background: white;
            border-bottom: 1px solid var(--header-border-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
            width: 100%;
            margin: 0;
            padding: 0;
            border-left: none !important;
            border-right: none !important;
            border-top: none !important;
        }

        .header-sticky.scrolled {
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        }

        .header-row-2 {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 10px 20px !important;
            gap: 12px !important;
            transition: padding 0.3s ease, gap 0.3s ease !important;
            flex-wrap: nowrap !important;
            width: 100% !important;
            margin: 0 !important;
            border: none !important;
        }

        .logo-icon {
            width: 40px !important;
            height: 40px !important;
            background: transparent !important;
            border-radius: 10px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            flex-shrink: 0 !important;
            text-decoration: none !important;
            padding: 0 !important;
            overflow: hidden !important;
        }

        .logo-icon img {
            width: 100% !important;
            height: 100% !important;
            object-fit: contain !important;
            display: block !important;
        }

        .row2-brand {
            font-family: 'Didot', serif;
            font-weight: 700;
            font-size: 22px;
            color: var(--header-primary-color);
            text-decoration: none;
            white-space: nowrap;
            flex-shrink: 0;
            max-width: 150px;
            opacity: 1;
            margin-right: 10px;
            display: block;
        }

        .site-header .search-box,
        .header-row-2 .search-box {
            position: relative !important;
            width: 280px !important;
            min-width: 250px !important;
            max-width: 320px !important;
            flex: none !important;
            flex-shrink: 0 !important;
            display: block !important;
            transition: width 0.3s ease, min-width 0.3s ease;
        }

        .site-header .search-input,
        .header-row-2 .search-input {
            width: 100% !important;
            padding: 10px 40px 10px 14px !important;
            border: 1px solid var(--header-border-color) !important;
            border-right: 1px solid var(--header-border-color) !important;
            border-radius: 8px !important;
            font-family: 'DM Sans', sans-serif !important;
            font-size: 13px !important;
            box-sizing: border-box !important;
            transition: border-color 0.2s ease !important;
            flex: none !important;
        }

        .site-header .search-input:focus,
        .header-row-2 .search-input:focus {
            outline: none !important;
            border-color: var(--header-accent-color) !important;
        }

        .site-header .search-icon,
        .header-row-2 .search-icon {
            position: absolute !important;
            right: 14px !important;
            top: 50% !important;
            transform: translateY(-50%) !important;
            color: var(--header-text-secondary) !important;
            font-size: 14px !important;
            pointer-events: none !important;
        }

        .site-header .catalog-btn {
            background: var(--header-accent-color) !important;
            color: white !important;
            padding: 9px 18px !important;
            border-radius: 8px !important;
            border: none !important;
            cursor: pointer !important;
            font-family: 'DM Sans', sans-serif !important;
            font-weight: 600 !important;
            font-size: 13px !important;
            white-space: nowrap !important;
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            flex-shrink: 0 !important;
            transition: background 0.2s ease !important;
        }

        .site-header .catalog-btn:hover {
            background: var(--header-primary-color) !important;
        }

        .site-header .cart-btn {
            background: var(--header-accent-color) !important;
            color: white !important;
            padding: 9px 16px !important;
            border-radius: 8px !important;
            border: none !important;
            cursor: pointer !important;
            font-family: 'DM Sans', sans-serif !important;
            font-weight: 600 !important;
            font-size: 13px !important;
            white-space: nowrap !important;
            display: flex !important;
            align-items: center !important;
            gap: 6px !important;
            flex-shrink: 0 !important;
            text-decoration: none !important;
            transition: background 0.2s ease !important;
        }

        .site-header .cart-btn:hover {
            background: var(--header-primary-color) !important;
        }

        .cart-badge {
            background: white;
            color: var(--accent-color);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: 700;
            min-width: 18px;
            text-align: center;
        }

        .cart-badge.hidden {
            display: none;
        }

        /* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –∫–Ω–æ–ø–∫–∏ "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ç–∞—Ä–æ–º—É –≤–∏–¥—É */
        #cabinet-header-btn .cabinet-header-btn,
        #cabinet-header-btn a.cabinet-header-btn {
            background: transparent !important;
            border: 1px solid var(--header-border-color) !important;
            color: var(--header-text-primary) !important;
            padding: 9px 16px !important;
            border-radius: 8px !important;
            font-family: 'DM Sans', sans-serif !important;
            font-weight: 600 !important;
            font-size: 13px !important;
            white-space: nowrap !important;
            display: flex !important;
            align-items: center !important;
            gap: 6px !important;
            flex-shrink: 0 !important;
            text-decoration: none !important;
            box-shadow: none !important;
            overflow: visible !important;
            text-overflow: clip !important;
            max-width: none !important;
            min-width: auto !important;
            width: auto !important;
            position: relative !important;
        }

        #cabinet-header-btn .cabinet-header-btn:hover,
        #cabinet-header-btn a.cabinet-header-btn:hover {
            border-color: var(--header-accent-color) !important;
            color: var(--header-accent-color) !important;
            background: transparent !important;
        }

        #cabinet-header-btn .cabinet-header-btn--authorized,
        #cabinet-header-btn a.cabinet-header-btn--authorized {
            background: transparent !important;
            border: 1px solid var(--header-border-color) !important;
            color: var(--header-text-primary) !important;
        }

        #cabinet-header-btn .cabinet-header-btn--authorized:hover,
        #cabinet-header-btn a.cabinet-header-btn--authorized:hover {
            border-color: var(--header-accent-color) !important;
            color: var(--header-accent-color) !important;
            background: transparent !important;
        }

        #cabinet-header-btn .cabinet-header-btn--authorized::after {
            display: none !important;
        }

        /* –ò–∫–æ–Ω–∫–∞ –≤ –∫–Ω–æ–ø–∫–µ */
        #cabinet-header-btn .cabinet-header-btn__icon,
        .header-sticky #cabinet-header-btn .cabinet-header-btn__icon {
            width: auto !important;
            height: auto !important;
            opacity: 1 !important;
            flex-shrink: 0 !important;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–Ω–æ–ø–∫–∏ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ */
        #cabinet-header-btn {
            flex-shrink: 0 !important;
            display: flex !important;
            align-items: center !important;
            min-width: 0 !important;
            overflow: visible !important;
            max-width: none !important;
            width: auto !important;
        }

        .header-row-2 #cabinet-header-btn {
            flex-shrink: 0 !important;
            overflow: visible !important;
        }

        /* –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–±—Ä–µ–∑–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ header */
        .site-header,
        .nav-container {
            overflow: visible !important;
        }

        .header-sticky {
            overflow: visible !important;
        }

        /* –£–±–∏—Ä–∞–µ–º –≤–∏–¥–∏–º—ã–µ –∫—Ä–∞—è —à–∞–ø–∫–∏ */
        body {
            margin: 0;
            padding: 0;
        }

        html {
            margin: 0;
            padding: 0;
        }


        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 1024px) {
            .search-box {
                width: 200px !important;
                min-width: 200px !important;
            }
        }

        @media (max-width: 768px) {
            .search-box {
                width: 150px !important;
                min-width: 150px !important;
            }

            #cabinet-header-btn .cabinet-header-btn,
            #cabinet-header-btn a.cabinet-header-btn {
                padding: 9px 12px !important;
                font-size: 12px !important;
            }
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è scrolled —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        .header-sticky.scrolled #cabinet-header-btn .cabinet-header-btn,
        .header-sticky.scrolled #cabinet-header-btn a.cabinet-header-btn {
            background: transparent !important;
            border: 1px solid var(--border-color) !important;
            color: var(--text-primary) !important;
            white-space: nowrap !important;
            overflow: visible !important;
            text-overflow: clip !important;
        }

        .header-sticky.scrolled #cabinet-header-btn .cabinet-header-btn:hover,
        .header-sticky.scrolled #cabinet-header-btn a.cabinet-header-btn:hover {
            border-color: var(--accent-color) !important;
            color: var(--accent-color) !important;
            background: transparent !important;
        }

        .header-sticky.scrolled #cabinet-header-btn .cabinet-header-btn--authorized,
        .header-sticky.scrolled #cabinet-header-btn a.cabinet-header-btn--authorized {
            background: transparent !important;
            border: 1px solid var(--border-color) !important;
            color: var(--text-primary) !important;
        }

        /* –ò–∫–æ–Ω–∫–∞ –≤ –∫–Ω–æ–ø–∫–µ */
        #cabinet-header-btn .cabinet-header-btn__icon,
        .header-sticky #cabinet-header-btn .cabinet-header-btn__icon {
            width: auto !important;
            height: auto !important;
            opacity: 1 !important;
            flex-shrink: 0 !important;
        }

        /* ============================================
           –ö–ê–¢–ê–õ–û–ì
           ============================================ */
        .catalog-page {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .catalog-header {
            margin-bottom: 30px;
        }

        .catalog-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        /* Layout —Å –ª–µ–≤—ã–º —Å–∞–π–¥–±–∞—Ä–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        .catalog-layout {
            display: flex;
            gap: 30px;
            align-items: stretch;
            width: 100%;
        }

        /* –õ–ï–í–´–ô –°–ê–ô–î–ë–ê–† –° –§–ò–õ–¨–¢–†–ê–ú–ò */
        .catalog-sidebar {
            width: 280px;
            min-width: 280px;
            flex-shrink: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            box-sizing: border-box;
            height: 100%;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */
        .catalog-sidebar__content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .catalog-sidebar__content::-webkit-scrollbar {
            width: 6px;
        }

        .catalog-sidebar__content::-webkit-scrollbar-track {
            background: #f5f5f5;
            border-radius: 3px;
        }

        .catalog-sidebar__content::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .catalog-sidebar__content::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        .catalog-sidebar__title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0 0 20px 0;
            padding: 0 0 12px 0;
            border-bottom: 1px solid var(--border-color);
            width: 100%;
            box-sizing: border-box;
        }

        /* –ì—Ä—É–ø–ø—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        .filter-group {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .filter-group__title {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0 0 12px 0;
        }

        .catalog-filters {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            box-sizing: border-box;
        }


        /* –§–ò–õ–¨–¢–† –ü–û –¶–í–ï–¢–£ (–≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Å–≤–æ—Ç—á–∏) */
        .filter-colors {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .color-swatch {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .color-swatch:hover {
            transform: scale(1.1);
            border-color: var(--accent-color);
        }

        .color-swatch.active {
            border-color: var(--accent-color);
            border-width: 3px;
            box-shadow: 0 0 0 2px rgba(212, 165, 116, 0.3);
        }

        .color-swatch.active::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* –§–ò–õ–¨–¢–† –ü–û –°–û–°–¢–ê–í–£ (—á–µ–∫–±–æ–∫—Å—ã) */
        .filter-composition {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            padding: 4px 0;
        }

        .filter-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent-color);
        }

        .filter-checkbox span {
            user-select: none;
        }

        /* –§–ò–õ–¨–¢–† –ü–û –ü–õ–û–¢–ù–û–°–¢–ò */
        .filter-density {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .density-range {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .density-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            font-family: 'DM Sans', sans-serif;
            box-sizing: border-box;
        }

        .density-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .density-separator {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .density-slider-wrapper {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .density-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            outline: none;
            -webkit-appearance: none;
        }

        .density-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
        }

        .density-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            border: none;
        }

        /* –§–ò–õ–¨–¢–† –ü–û –°–¢–ê–¢–£–°–£ */
        .filter-status {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º */
        .catalog-content {
            flex: 1;
            min-width: 0;
        }

        .catalog-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .catalog-sorting {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .catalog-sorting__label {
            font-size: 14px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .catalog-sorting__select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 13px;
            font-family: 'DM Sans', sans-serif;
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            outline: none;
        }

        .catalog-sorting__select:focus {
            border-color: var(--accent-color);
        }

        .catalog-loading,
        .catalog-error,
        .catalog-empty {
            text-align: center;
            padding: 60px 20px;
            font-size: 16px;
            color: var(--text-secondary);
        }

        .catalog-error {
            color: #ef4444;
        }

        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .catalog-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .catalog-sidebar {
                width: 240px;
                min-width: 240px;
            }
        }

        @media (max-width: 968px) {
            .catalog-layout {
                flex-direction: column;
                align-items: stretch;
            }

            .catalog-sidebar {
                width: 100%;
                height: auto;
            }

            .catalog-sidebar__content {
                overflow-y: visible;
            }

            .catalog-filters {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .catalog-filter-btn {
                width: auto;
            }
        }

        @media (max-width: 768px) {
            .catalog-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .catalog-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .catalog-sorting {
                justify-content: space-between;
            }
        }

        @media (max-width: 480px) {
            .catalog-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .catalog-sidebar {
                padding: 16px;
            }
        }

        .show-more-btn {
            display: block;
            margin: 30px auto 0;
            padding: 12px 40px;
            background: white;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
            min-width: 160px;
        }

        .show-more-btn:hover:not(:disabled) {
            background: var(--accent-color);
            color: white;
        }

        .show-more-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .show-more-btn.loading {
            position: relative;
            color: transparent;
        }

        .show-more-btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            border: 2px solid var(--accent-color);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        .show-more-btn.hidden {
            display: none;
        }

        .catalog-end-message {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 30px;
            display: none;
        }

        .catalog-end-message.visible {
            display: block;
        }

        /* –ö–õ–ê–°–°–ò–ß–ï–°–ö–ê–Ø –ü–ê–ì–ò–ù–ê–¶–ò–Ø */
        .catalog-pagination {
            display: none;
            /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS –ø—Ä–∏ totalPages > 1 */
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 40px 0 20px;
            flex-wrap: wrap;
            width: 100%;
        }

        .catalog-pagination.show {
            display: flex;
        }

        .pagination-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
            min-width: 40px;
            height: 40px;
        }

        .pagination-btn:hover:not(:disabled) {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .pagination-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .pagination-pages {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .pagination-page {
            padding: 8px 12px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
            min-width: 40px;
            height: 40px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pagination-page:hover:not(:disabled) {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .pagination-page.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            cursor: default;
        }

        .pagination-page:disabled {
            cursor: default;
        }
    </style>
</head>

<body>
    <!-- HEADER -->
    <header class="site-header">
        <div class="header-sticky" id="headerSticky">
            <div class="nav-container">
                <div class="header-row-2">
                    <a href="index.html" class="logo-icon">
                        <img src="icons/LogoBazarbuy.svg" alt="Bazar Buy">
                    </a>
                    <a href="index.html" class="row2-brand">Bazar Buy</a>

                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...">
                        <span class="search-icon">üîç</span>
                    </div>

                    <div id="cabinet-header-btn"></div>

                    <a href="cart.html" class="cart-btn">
                        <span>üõí</span>
                        <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
                        <span class="cart-badge hidden" id="cartBadge">0</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- –ö–ê–¢–ê–õ–û–ì –¢–û–í–ê–†–û–í -->
    <main class="catalog-page">
        <div class="catalog-header">
            <h1 class="catalog-title">–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>
        </div>

        <div class="catalog-layout">
            <!-- –õ–ï–í–´–ô –°–ê–ô–î–ë–ê–† –° –§–ò–õ–¨–¢–†–ê–ú–ò -->
            <aside class="catalog-sidebar" id="catalog-filters">
                <h2 class="catalog-sidebar__title">–§–∏–ª—å—Ç—Ä—ã</h2>

                <div class="catalog-sidebar__content">
                    <!-- 1. –§–ò–õ–¨–¢–† –¶–í–ï–¢ (single select) -->
                    <div class="filter-group">
                        <h3 class="filter-group__title">–¶–≤–µ—Ç</h3>
                        <div class="filter filter-colors" id="filterColors">
                            <!-- –¶–≤–µ—Ç–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>

                    <!-- 2. –§–ò–õ–¨–¢–† –¢–ò–ü –¢–ö–ê–ù–ò (single select) -->
                    <div class="filter-group">
                        <h3 class="filter-group__title">–¢–∏–ø —Ç–∫–∞–Ω–∏</h3>
                        <div class="filter filter-fabric-type" id="filterFabricType">
                            <button class="filter-btn active" data-fabric-type="all">–í—Å–µ</button>
                            <button class="filter-btn" data-fabric-type="velour">–í–µ–ª—é—Ä</button>
                            <button class="filter-btn" data-fabric-type="viscose">–í–∏—Å–∫–æ–∑–∞</button>
                            <button class="filter-btn" data-fabric-type="gabardine">–ì–∞–±–∞—Ä–¥–∏–Ω</button>
                            <button class="filter-btn" data-fabric-type="linen">–õ—ë–Ω</button>
                            <button class="filter-btn" data-fabric-type="organza">–û—Ä–≥–∞–Ω–∑–∞</button>
                            <button class="filter-btn" data-fabric-type="poplin">–ü–æ–ø–ª–∏–Ω</button>
                            <button class="filter-btn" data-fabric-type="synthetic">–°–∏–Ω—Ç–µ—Ç–∏–∫–∞</button>
                            <button class="filter-btn" data-fabric-type="cotton">–•–ª–æ–ø–æ–∫</button>
                            <button class="filter-btn" data-fabric-type="wool">–®–µ—Ä—Å—Ç—å</button>
                            <button class="filter-btn" data-fabric-type="silk">–®—ë–ª–∫</button>
                        </div>
                    </div>

                    <!-- 3. –§–ò–õ–¨–¢–† –°–û–°–¢–ê–í (multi select) -->
                    <div class="filter-group">
                        <h3 class="filter-group__title">–°–æ—Å—Ç–∞–≤</h3>
                        <div class="filter filter-composition" id="filterComposition">
                            <label class="filter-checkbox">
                                <input type="checkbox" value="cotton">
                                <span>–•–ª–æ–ø–æ–∫</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" value="polyester">
                                <span>–ü–æ–ª–∏—ç—Å—Ç–µ—Ä</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" value="linen">
                                <span>–õ—ë–Ω</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" value="viscose">
                                <span>–í–∏—Å–∫–æ–∑–∞</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" value="wool">
                                <span>–®–µ—Ä—Å—Ç—å</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" value="mixed">
                                <span>–°–º–µ—Å–æ–≤—ã–µ</span>
                            </label>
                        </div>
                    </div>

                    <!-- 4. –§–ò–õ–¨–¢–† –ü–õ–û–¢–ù–û–°–¢–¨ (range) -->
                    <div class="filter-group">
                        <h3 class="filter-group__title">–ü–ª–æ—Ç–Ω–æ—Å—Ç—å (–≥/–º¬≤)</h3>
                        <div class="filter filter-density" id="filterDensity">
                            <div class="range-inputs">
                                <input type="number" id="densityMin" class="range-input" placeholder="–û—Ç" min="0"
                                    max="1000">
                                <span class="range-separator">‚Äî</span>
                                <input type="number" id="densityMax" class="range-input" placeholder="–î–æ" min="0"
                                    max="1000">
                            </div>
                            <div class="range-sliders">
                                <input type="range" id="densitySliderMin" class="range-slider" min="0" max="1000"
                                    value="0">
                                <input type="range" id="densitySliderMax" class="range-slider" min="0" max="1000"
                                    value="1000">
                            </div>
                        </div>
                    </div>

                    <!-- 5. –§–ò–õ–¨–¢–† –¶–ï–ù–ê (range) -->
                    <div class="filter-group">
                        <h3 class="filter-group__title">–¶–µ–Ω–∞ (‚ÇΩ)</h3>
                        <div class="filter filter-price" id="filterPrice">
                            <div class="range-inputs">
                                <input type="number" id="priceMin" class="range-input" placeholder="–û—Ç" min="0">
                                <span class="range-separator">‚Äî</span>
                                <input type="number" id="priceMax" class="range-input" placeholder="–î–æ" min="0">
                            </div>
                            <div class="range-sliders">
                                <input type="range" id="priceSliderMin" class="range-slider" min="0" max="10000"
                                    value="0">
                                <input type="range" id="priceSliderMax" class="range-slider" min="0" max="10000"
                                    value="10000">
                            </div>
                        </div>
                    </div>

                    <!-- 6. –§–ò–õ–¨–¢–† –°–¢–ê–¢–£–° –¢–û–í–ê–†–ê (multi select) -->
                    <div class="filter-group">
                        <h3 class="filter-group__title">–°—Ç–∞—Ç—É—Å —Ç–æ–≤–∞—Ä–∞</h3>
                        <div class="filter filter-status" id="filterStatus">
                            <label class="filter-checkbox">
                                <input type="checkbox" value="in_stock">
                                <span>–í –ø—Ä–æ–¥–∞–∂–µ</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" value="in_transit">
                                <span>–í –ø—É—Ç–∏</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" value="preorder">
                                <span>–ü—Ä–µ–¥–∑–∞–∫–∞–∑</span>
                            </label>
                        </div>
                    </div>

                    <!-- –ö–ù–û–ü–ö–ê –°–ë–†–û–°–ê -->
                    <div class="filter-group">
                        <button class="filter-reset-btn" id="filterResetBtn">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                    </div>
                </div>
            </aside>

            <!-- –ü–†–ê–í–ê–Ø –ß–ê–°–¢–¨ –° –ö–û–ù–¢–ï–ù–¢–û–ú -->
            <div class="catalog-content">
                <div class="catalog-controls">
                    <div class="catalog-sorting" id="catalogSorting">
                        <span class="catalog-sorting__label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
                        <select class="catalog-sorting__select" id="sortSelect">
                            <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                            <option value="price-asc">–ü–æ —Ü–µ–Ω–µ ‚Üë</option>
                            <option value="price-desc">–ü–æ —Ü–µ–Ω–µ ‚Üì</option>
                            <option value="new">–ü–æ –Ω–æ–≤–∏–∑–Ω–µ</option>
                        </select>
                    </div>
                </div>

                <div id="catalogGrid" class="catalog-grid">
                    <!-- –ö–∞—Ç–∞–ª–æ–≥ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <!-- –ö–õ–ê–°–°–ò–ß–ï–°–ö–ê–Ø –ü–ê–ì–ò–ù–ê–¶–ò–Ø -->
                <div class="catalog-pagination" id="catalogPagination">
                    <button class="pagination-btn pagination-prev" id="paginationPrev" disabled>‚Üê</button>
                    <div class="pagination-pages" id="paginationPages">
                        <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    <button class="pagination-btn pagination-next" id="paginationNext">‚Üí</button>
                </div>
            </div>
        </div>

        <div id="catalogStates" style="display: none;">
            <div class="catalog-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤‚Ä¶</div>
            <div class="catalog-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.</div>
            <div class="catalog-empty">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
        </div>
    </main>

    <!-- SCRIPTS -->
    <!-- –ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ -->
    <script type="module" src="js/catalog/eventBus.js"></script>
    <!-- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
    <script type="module" src="js/catalog/data-sources/localJSONSource.js"></script>
    <script type="module" src="js/catalog/data-sources/wordpressRESTSource.js"></script>
    <!-- –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö -->
    <script type="module" src="js/catalog/dataStore.js"></script>
    <!-- Phase 5A: Error handling extension (decorator) -->
    <script type="module" src="js/catalog/dataStore-errorHandling.js"></script>
    <!-- Phase 5B: Initialization helper (load early) -->
    <script type="module" src="js/catalog/catalogReady.js"></script>
    <script type="module" src="js/catalog/filters.js"></script>
    <!-- Phase 5B: Guards (load AFTER modules) -->
    <script type="module" src="js/catalog/filters-guards.js"></script>
    <script type="module" src="js/catalog/sorting.js"></script>
    <script type="module" src="js/catalog/pagination.js"></script>
    <!-- Phase 5B: Guards (load AFTER modules) -->
    <script type="module" src="js/catalog/pagination-guards.js"></script>
    <script type="module" src="js/catalog/productCard.js"></script>
    <script type="module" src="js/catalog/catalog-core.js"></script>
    <!-- Phase 5A: Fallback UI extension -->
    <script type="module" src="js/catalog/catalogFallbackUI.js"></script>
    <script type="module" src="js/catalog/integration.js"></script>
    <!-- Phase 6: Scroll lock utility (before modules that use it) -->
    <script type="module" src="js/utils/scrollLock.js"></script>
    <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏ -->
    <script type="module" src="js/catalog.js"></script>
    <script type="module" src="js/product-popup.js"></script>
    <!-- ============================================ -->
    <!-- –ù–û–í–´–ï –ú–û–î–£–õ–ò –ö–ê–¢–ê–õ–û–ì–ê (–¥–æ–±–∞–≤–ª–µ–Ω–æ –ü–û–°–õ–ï —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö) -->
    <!-- ============================================ -->

    <!-- 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ DataStore -->
    <script type="module" src="js/catalog/dataStoreNavigation.js"></script>

    <!-- 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
    <script type="module" src="js/catalog/paginationFix.js"></script>

    <!-- 3. –ú–µ–Ω—é -->
    <script type="module" src="js/menu/megaMenu.js"></script>
    <!-- Phase 5B: Guards (load AFTER modules) -->
    <script type="module" src="js/menu/megaMenu-guards.js"></script>
    <script type="module" src="js/menu/catalogButton.js"></script>
    <!-- Phase 5B: Guards (load AFTER modules) -->
    <script type="module" src="js/menu/catalogButton-guards.js"></script>

    <!-- 4. –ü–æ–∏—Å–∫ -->
    <script type="module" src="js/search/searchController.js"></script>
    <!-- Phase 5B: Guards (load AFTER modules) -->
    <script type="module" src="js/search/searchController-guards.js"></script>

    <!-- 5. SEO -->
    <script type="module" src="js/seo/seoController.js"></script>

    <script type="module" src="js/cart-store.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞
                const catalogGrid = document.getElementById('catalogGrid');
                const sortSelect = document.getElementById('sortSelect');

                if (!catalogGrid || !sortSelect) {
                    throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã DOM');
                }

                // STATE –§–ò–õ–¨–¢–†–û–í (–µ–¥–∏–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó)
                const filtersState = {
                    color: null,
                    fabricType: null,
                    composition: [],
                    density: { min: null, max: null },
                    price: { min: null, max: null },
                    status: []
                };

                // –ü–ê–ì–ò–ù–ê–¶–ò–Ø (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∫–Ω–æ–ø–æ—á–Ω–∞—è)
                let currentPage = 1;
                const perPage = 8; // –í–†–ï–ú–ï–ù–ù–û —É–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 24)
                let totalPages = 1;
                let totalItems = 0; // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –ü–û–°–õ–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤, –î–û –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –æ –ø–æ–∫–∞–∑–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏)

                let isLoading = false;

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ (–æ–±—ä—è–≤–ª–µ–Ω–æ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ applyFiltersLocally)
                let searchResults = null;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥—É–ª–µ–π
                if (typeof CatalogDataStore === 'undefined') {
                    throw new Error('CatalogDataStore –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                if (typeof CatalogProductCard === 'undefined') {
                    throw new Error('CatalogProductCard –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
                await CatalogDataStore.load('data/products.json');
                const allProducts = CatalogDataStore.getAllProducts();

                // –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –§–ò–õ–¨–¢–†–û–í –ò–ó URL
                restoreFiltersFromURL();

                // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –í–°–ï–• –§–ò–õ–¨–¢–†–û–í
                initAllFilters(allProducts);

                // –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï UI –ò–ó STATE
                restoreFiltersUI();

                // –ü–ï–†–í–û–ù–ê–ß–ê–õ–¨–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –ö–ê–¢–ê–õ–û–ì–ê
                console.log('[INIT] –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞');
                await loadCatalog();

                // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SearchController
                if (window.CatalogEventBus) {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
                    window.CatalogEventBus.on('catalog:filtered', function (detail) {
                        if (detail && detail.source === 'search') {
                            if (detail.products && detail.products.length > 0) {
                                handleSearchResults(detail.products, detail.query);
                            } else {
                                // –ü–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –Ω–æ –Ω—É–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
                                searchResults = [];
                                handleSearchResults([], detail.query);
                            }
                        }
                    });

                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–±—Ä–æ—Å–∞ –ø–æ–∏—Å–∫–∞ (–∫–æ–≥–¥–∞ –ø–æ–ª–µ –æ—á–∏—â–µ–Ω–æ)
                    window.CatalogEventBus.on('search:change', function (detail) {
                        if (!detail || !detail.query || detail.query.length < 2) {
                            // –ü–æ–∏—Å–∫ —Å–±—Ä–æ—à–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –æ–±—ã—á–Ω–æ–º—É –∫–∞—Ç–∞–ª–æ–≥—É
                            searchResults = null;
                            loadCatalog();
                        }
                    });
                }

                // ============================================
                // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –í–°–ï–• –§–ò–õ–¨–¢–†–û–í
                // ============================================
                function initAllFilters(products) {
                    initColorFilter(products);
                    initFabricTypeFilter();
                    initCompositionFilter();
                    initDensityFilter(products);
                    initPriceFilter(products);
                    initStatusFilter();
                    initResetButton();
                }

                // 1. –§–ò–õ–¨–¢–† –¶–í–ï–¢ (single select - —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–µ–Ω)
                function initColorFilter(products) {
                    const colorsContainer = document.getElementById('filterColors');
                    if (!colorsContainer) return;

                    const allColors = new Set();
                    products.forEach(p => {
                        if (p.colors && Array.isArray(p.colors)) {
                            p.colors.forEach(color => allColors.add(color));
                        }
                    });

                    const colorMap = {
                        '–±–µ–ª—ã–π': '#FFFFFF', '—á—ë—Ä–Ω—ã–π': '#000000', '—Å–∏–Ω–∏–π': '#0000FF',
                        '–∫—Ä–∞—Å–Ω—ã–π': '#FF0000', '–≥–æ–ª—É–±–æ–π': '#87CEEB', '—Ä–æ–∑–æ–≤—ã–π': '#FFC0CB',
                        '–±–µ–∂–µ–≤—ã–π': '#F5F5DC', '–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π': '#D2B48C', '–∑–æ–ª–æ—Ç–æ': '#FFD700',
                        '—Å–µ—Ä–µ–±—Ä–æ': '#C0C0C0', '–±–æ—Ä–¥–æ': '#800020', '—Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π': '#00008B',
                        '—Å–µ—Ä—ã–π': '#808080'
                    };

                    Array.from(allColors).sort().forEach(color => {
                        const swatch = document.createElement('button');
                        swatch.className = 'color-swatch';
                        swatch.dataset.color = color;
                        swatch.style.backgroundColor = colorMap[color.toLowerCase()] || '#CCCCCC';
                        swatch.title = color;
                        swatch.addEventListener('click', () => handleColorFilter(color, swatch));
                        colorsContainer.appendChild(swatch);
                    });
                }

                function handleColorFilter(color, swatch) {
                    // Single select: –µ—Å–ª–∏ —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω - —Å–Ω–∏–º–∞–µ–º, –∏–Ω–∞—á–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º
                    if (filtersState.color === color) {
                        filtersState.color = null;
                        swatch.classList.remove('active');
                    } else {
                        // –°–Ω–∏–º–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å –¥—Ä—É–≥–∏—Ö
                        document.querySelectorAll('#filterColors .color-swatch').forEach(s => s.classList.remove('active'));
                        filtersState.color = color;
                        swatch.classList.add('active');
                    }
                    applyFilters();
                }

                // 2. –§–ò–õ–¨–¢–† –¢–ò–ü –¢–ö–ê–ù–ò (single select)
                function initFabricTypeFilter() {
                    const fabricTypeButtons = document.querySelectorAll('#filterFabricType .filter-btn');
                    fabricTypeButtons.forEach(btn => {
                        btn.addEventListener('click', () => {
                            const fabricType = btn.dataset.fabricType;
                            if (fabricType === 'all') {
                                filtersState.fabricType = null;
                            } else {
                                filtersState.fabricType = fabricType;
                            }
                            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                            fabricTypeButtons.forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            applyFilters();
                        });
                    });
                }

                // 3. –§–ò–õ–¨–¢–† –°–û–°–¢–ê–í (multi select - —á–µ–∫–±–æ–∫—Å—ã)
                function initCompositionFilter() {
                    const compositionCheckboxes = document.querySelectorAll('#filterComposition input[type="checkbox"]');
                    compositionCheckboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', () => {
                            const value = checkbox.value;
                            if (checkbox.checked) {
                                if (!filtersState.composition.includes(value)) {
                                    filtersState.composition.push(value);
                                }
                            } else {
                                filtersState.composition = filtersState.composition.filter(v => v !== value);
                            }
                            applyFilters();
                        });
                    });
                }

                // 4. –§–ò–õ–¨–¢–† –ü–õ–û–¢–ù–û–°–¢–¨ (range - –¥–≤–∞ input + —Å–ª–∞–π–¥–µ—Ä—ã)
                function initDensityFilter(products) {
                    const densityMin = document.getElementById('densityMin');
                    const densityMax = document.getElementById('densityMax');
                    const sliderMin = document.getElementById('densitySliderMin');
                    const sliderMax = document.getElementById('densitySliderMax');

                    if (!densityMin || !densityMax || !sliderMin || !sliderMax) return;

                    // –ù–∞—Ö–æ–¥–∏–º min –∏ max –ø–ª–æ—Ç–Ω–æ—Å—Ç—å
                    let minDensity = 0;
                    let maxDensity = 1000;
                    products.forEach(p => {
                        if (p.density) {
                            const density = Number(p.density);
                            if (!isNaN(density)) {
                                minDensity = Math.min(minDensity, density);
                                maxDensity = Math.max(maxDensity, density);
                            }
                        }
                    });

                    sliderMin.min = minDensity;
                    sliderMin.max = maxDensity;
                    sliderMin.value = minDensity;
                    sliderMax.min = minDensity;
                    sliderMax.max = maxDensity;
                    sliderMax.value = maxDensity;

                    densityMin.placeholder = `–û—Ç ${minDensity}`;
                    densityMax.placeholder = `–î–æ ${maxDensity}`;

                    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
                    const syncDensity = () => {
                        const min = Number(densityMin.value) || minDensity;
                        const max = Number(densityMax.value) || maxDensity;
                        filtersState.density = { min: min > minDensity ? min : null, max: max < maxDensity ? max : null };
                        applyFilters();
                    };

                    sliderMin.addEventListener('input', (e) => {
                        densityMin.value = e.target.value;
                        if (Number(densityMin.value) > Number(densityMax.value)) {
                            densityMax.value = densityMin.value;
                            sliderMax.value = densityMin.value;
                        }
                        syncDensity();
                    });

                    sliderMax.addEventListener('input', (e) => {
                        densityMax.value = e.target.value;
                        if (Number(densityMax.value) < Number(densityMin.value)) {
                            densityMin.value = densityMax.value;
                            sliderMin.value = densityMax.value;
                        }
                        syncDensity();
                    });

                    densityMin.addEventListener('input', syncDensity);
                    densityMax.addEventListener('input', syncDensity);
                }

                // 5. –§–ò–õ–¨–¢–† –¶–ï–ù–ê (range - –¥–≤–∞ input + —Å–ª–∞–π–¥–µ—Ä—ã)
                function initPriceFilter(products) {
                    const priceMin = document.getElementById('priceMin');
                    const priceMax = document.getElementById('priceMax');
                    const sliderMin = document.getElementById('priceSliderMin');
                    const sliderMax = document.getElementById('priceSliderMax');

                    if (!priceMin || !priceMax || !sliderMin || !sliderMax) return;

                    // –ù–∞—Ö–æ–¥–∏–º min –∏ max —Ü–µ–Ω—É
                    let minPrice = 0;
                    let maxPrice = 10000;
                    products.forEach(p => {
                        if (p.price && typeof p.price === 'number') {
                            minPrice = Math.min(minPrice, p.price);
                            maxPrice = Math.max(maxPrice, p.price);
                        }
                    });

                    sliderMin.min = minPrice;
                    sliderMin.max = maxPrice;
                    sliderMin.value = minPrice;
                    sliderMax.min = minPrice;
                    sliderMax.max = maxPrice;
                    sliderMax.value = maxPrice;

                    priceMin.placeholder = `–û—Ç ${minPrice}`;
                    priceMax.placeholder = `–î–æ ${maxPrice}`;

                    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
                    const syncPrice = () => {
                        const min = Number(priceMin.value) || minPrice;
                        const max = Number(priceMax.value) || maxPrice;
                        filtersState.price = { min: min > minPrice ? min : null, max: max < maxPrice ? max : null };
                        applyFilters();
                    };

                    sliderMin.addEventListener('input', (e) => {
                        priceMin.value = e.target.value;
                        if (Number(priceMin.value) > Number(priceMax.value)) {
                            priceMax.value = priceMin.value;
                            sliderMax.value = priceMin.value;
                        }
                        syncPrice();
                    });

                    sliderMax.addEventListener('input', (e) => {
                        priceMax.value = e.target.value;
                        if (Number(priceMax.value) < Number(priceMin.value)) {
                            priceMin.value = priceMax.value;
                            sliderMin.value = priceMax.value;
                        }
                        syncPrice();
                    });

                    priceMin.addEventListener('input', syncPrice);
                    priceMax.addEventListener('input', syncPrice);
                }

                // 6. –§–ò–õ–¨–¢–† –°–¢–ê–¢–£–° (multi select - —á–µ–∫–±–æ–∫—Å—ã)
                function initStatusFilter() {
                    const statusCheckboxes = document.querySelectorAll('#filterStatus input[type="checkbox"]');
                    statusCheckboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', () => {
                            const value = checkbox.value;
                            if (checkbox.checked) {
                                if (!filtersState.status.includes(value)) {
                                    filtersState.status.push(value);
                                }
                            } else {
                                filtersState.status = filtersState.status.filter(v => v !== value);
                            }
                            applyFilters();
                        });
                    });
                }

                // –ö–ù–û–ü–ö–ê –°–ë–†–û–°–ê
                function initResetButton() {
                    const resetBtn = document.getElementById('filterResetBtn');
                    if (resetBtn) {
                        resetBtn.addEventListener('click', resetFilters);
                    }
                }

                // ============================================
                // –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –§–ò–õ–¨–¢–†–û–í –ò –ó–ê–ü–†–û–° –ö API
                // ============================================
                function applyFilters() {
                    if (isLoading) return;

                    // –°–ë–†–û–° –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–±—ã—á–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
                    searchResults = null;

                    // –°–ë–†–û–° –ü–ê–ì–ò–ù–ê–¶–ò–ò –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
                    currentPage = 1;

                    // –û–±–Ω–æ–≤–ª—è–µ–º URL
                    updateURL();

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
                    loadCatalog();
                }

                // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ query string –¥–ª—è API
                function buildQueryString() {
                    const params = new URLSearchParams();

                    if (filtersState.color) params.append('color', filtersState.color);
                    if (filtersState.fabricType) params.append('fabric_type', filtersState.fabricType);
                    if (filtersState.composition.length > 0) params.append('composition', filtersState.composition.join(','));
                    if (filtersState.density.min !== null) params.append('density_min', filtersState.density.min);
                    if (filtersState.density.max !== null) params.append('density_max', filtersState.density.max);
                    if (filtersState.price.min !== null) params.append('price_min', filtersState.price.min);
                    if (filtersState.price.max !== null) params.append('price_max', filtersState.price.max);
                    if (filtersState.status.length > 0) params.append('status', filtersState.status.join(','));

                    params.append('page', currentPage);
                    params.append('per_page', perPage);

                    return params.toString();
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
                async function loadCatalog() {
                    if (isLoading) return;

                    isLoading = true;
                    catalogGrid.innerHTML = '<div class="catalog-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤‚Ä¶</div>';

                    try {
                        // TODO: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π API –∑–∞–ø—Ä–æ—Å –∫ WordPress
                        // const queryString = buildQueryString();
                        // const response = await fetch(`/catalog/v1/products?${queryString}`);
                        // const data = await response.json();

                        // –í–†–ï–ú–ï–ù–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                        await CatalogDataStore.load('data/products.json');
                        let products = CatalogDataStore.getAllProducts();

                        console.log('[LOAD CATALOG] –¢–æ–≤–∞—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ —Ñ–∞–π–ª–∞:', products.length);
                        console.log('[LOAD CATALOG] –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –î–û –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:', JSON.stringify(filtersState));

                        if (!products || products.length === 0) {
                            throw new Error('–¢–æ–≤–∞—Ä—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞');
                        }

                        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ª–æ–∫–∞–ª—å–Ω–æ (–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
                        products = applyFiltersLocally(products);

                        console.log('[LOAD CATALOG] –¢–æ–≤–∞—Ä–æ–≤ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', products.length);

                        if (products.length === 0) {
                            console.warn('[LOAD CATALOG] –í–ù–ò–ú–ê–ù–ò–ï: –í—Å–µ —Ç–æ–≤–∞—Ä—ã –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã!', {
                                filtersState,
                                suggestion: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã - –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–º–∏'
                            });
                        }

                        // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: totalItems —Å—á–∏—Ç–∞–µ–º –î–û –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è slice (–ø–∞–≥–∏–Ω–∞—Ü–∏–∏)
                        // totalItems = –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –ü–û–°–õ–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤, –î–û –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
                        // –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –¢–û–õ–¨–ö–û –æ—Ç totalItems, –ù–ï –æ—Ç items.length
                        // –ü—Ä–∏–º–µ—Ä: 50 —Ç–æ–≤–∞—Ä–æ–≤, perPage = 24 ‚Üí totalPages = Math.ceil(50/24) = 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        totalItems = products.length;
                        totalPages = Math.ceil(totalItems / perPage);

                        console.log('[LOAD CATALOG] –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏:', {
                            totalItems,
                            perPage,
                            totalPages,
                            calculation: `Math.ceil(${totalItems} / ${perPage}) = ${totalPages}`,
                            example: '50 —Ç–æ–≤–∞—Ä–æ–≤ / 24 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ = 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã (24+24+2)',
                            shouldShow: totalPages > 1,
                            currentPage
                        });

                        // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –û–¢–õ–ê–î–û–ß–ù–´–ô –õ–û–ì
                        console.log('[PAGINATION]', {
                            totalItems,
                            perPage,
                            totalPages,
                            calculation: `${totalItems} / ${perPage} = ${(totalItems / perPage).toFixed(2)}, ceil = ${totalPages}`,
                            rule: '–ü–∞–≥–∏–Ω–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –¢–û–õ–¨–ö–û –æ—Ç totalItems, –ù–ï –æ—Ç items.length'
                        });

                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é (slice –ø–æ—Å–ª–µ –ø–æ–¥—Å—á–µ—Ç–∞ totalItems)
                        const start = (currentPage - 1) * perPage;
                        const end = start + perPage;
                        const paginatedProducts = products.slice(start, end);

                        console.log('[PAGINATION] –ü–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–æ–º:', {
                            totalItems: totalItems, // –û–ë–©–ï–ï –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
                            totalPages: totalPages,
                            currentPage: currentPage,
                            productsOnPage: paginatedProducts.length, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏)
                            shouldShowPagination: totalPages > 1, // –†–µ—à–µ–Ω–∏–µ –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ totalPages
                            rule: 'items.length –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –æ –ø–æ–∫–∞–∑–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏'
                        });

                        products = paginatedProducts;

                        renderCatalog(products);
                        renderPagination();
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞:', error);
                        catalogGrid.innerHTML = '<div class="catalog-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.</div>';
                    } finally {
                        isLoading = false;
                    }
                }

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
                function handleSearchResults(products, query) {
                    if (!products || products.length === 0) {
                        searchResults = null;
                        loadCatalog(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –±–µ–∑ –ø–æ–∏—Å–∫–∞
                        return;
                    }

                    searchResults = products;
                    currentPage = 1;

                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø–æ–∏—Å–∫–∞
                    totalItems = products.length;
                    totalPages = Math.ceil(totalItems / perPage);
                    const start = (currentPage - 1) * perPage;
                    const end = start + perPage;
                    const paginatedProducts = products.slice(start, end);

                    renderCatalog(paginatedProducts);
                    renderPagination();

                    console.log('[SEARCH] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:', {
                        query: query,
                        total: products.length,
                        onPage: paginatedProducts.length,
                        page: currentPage,
                        totalPages: totalPages
                    });
                }

                // –í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–¥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WordPress)
                function applyFiltersLocally(products) {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
                    if (searchResults !== null) {
                        return searchResults;
                    }

                    let filtered = [...products];
                    const originalCount = filtered.length;

                    // –§–∏–ª—å—Ç—Ä –ø–æ —Ü–≤–µ—Ç—É
                    if (filtersState.color) {
                        filtered = filtered.filter(p =>
                            p.colors && Array.isArray(p.colors) && p.colors.includes(filtersState.color)
                        );
                    }

                    // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —Ç–∫–∞–Ω–∏ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è)
                    if (filtersState.fabricType) {
                        const categoryMap = {
                            'velour': '–í–µ–ª—é—Ä', 'viscose': '–í–∏—Å–∫–æ–∑–∞', 'gabardine': '–ì–∞–±–∞—Ä–¥–∏–Ω',
                            'linen': '–õ—ë–Ω', 'organza': '–û—Ä–≥–∞–Ω–∑–∞', 'poplin': '–ü–æ–ø–ª–∏–Ω',
                            'synthetic': '–°–∏–Ω—Ç–µ—Ç–∏–∫–∞', 'cotton': '–•–ª–æ–ø–æ–∫', 'wool': '–®–µ—Ä—Å—Ç—å', 'silk': '–®—ë–ª–∫'
                        };
                        const category = categoryMap[filtersState.fabricType];
                        if (category) {
                            filtered = filtered.filter(p => p.category === category);
                        }
                    }

                    // –§–∏–ª—å—Ç—Ä –ø–æ —Å–æ—Å—Ç–∞–≤—É (–ø–æ–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º, —Ç.–∫. –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)
                    // –§–∏–ª—å—Ç—Ä –ø–æ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ (–ø–æ–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º, —Ç.–∫. –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)
                    // –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ
                    if (filtersState.price.min !== null) {
                        filtered = filtered.filter(p => p.price >= filtersState.price.min);
                    }
                    if (filtersState.price.max !== null) {
                        filtered = filtered.filter(p => p.price <= filtersState.price.max);
                    }

                    // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É - –ò–°–ü–†–ê–í–õ–ï–ù–û: —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
                    if (filtersState.status.length > 0) {
                        const beforeStatusFilter = filtered.length;
                        filtered = filtered.filter(p => {
                            // –í –ø—Ä–æ–¥–∞–∂–µ: –Ω–µ coming_soon (—Ç–æ–≤–∞—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–∫–∞–∑–∞)
                            if (filtersState.status.includes('in_stock') && !p.coming_soon) return true;
                            // –í –ø—É—Ç–∏: coming_soon = true
                            if (filtersState.status.includes('in_transit') && p.coming_soon) return true;
                            // –ü—Ä–µ–¥–∑–∞–∫–∞–∑: coming_soon = true (—Ç–æ –∂–µ —á—Ç–æ –∏ –≤ –ø—É—Ç–∏)
                            if (filtersState.status.includes('preorder') && p.coming_soon) return true;
                            return false;
                        });
                        console.log('[FILTER STATUS]', {
                            before: beforeStatusFilter,
                            after: filtered.length,
                            statusFilters: filtersState.status,
                            warning: beforeStatusFilter > 0 && filtered.length === 0 ? '–í—Å–µ —Ç–æ–≤–∞—Ä—ã –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É!' : 'OK'
                        });
                    }

                    console.log('[FILTER RESULT]', {
                        original: originalCount,
                        filtered: filtered.length,
                        filtersApplied: {
                            color: filtersState.color,
                            fabricType: filtersState.fabricType,
                            price: filtersState.price,
                            status: filtersState.status
                        }
                    });

                    return filtered;
                }

                // ============================================
                // URL –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø
                // ============================================
                function updateURL() {
                    const queryString = buildQueryString();
                    const newURL = queryString ? `catalog.html?${queryString}` : 'catalog.html';
                    window.history.pushState({ filters: filtersState, page: currentPage }, '', newURL);
                }

                function restoreFiltersFromURL() {
                    const urlParams = new URLSearchParams(window.location.search);

                    if (urlParams.has('color')) filtersState.color = urlParams.get('color');
                    if (urlParams.has('fabric_type')) filtersState.fabricType = urlParams.get('fabric_type');
                    if (urlParams.has('composition')) filtersState.composition = urlParams.get('composition').split(',');
                    if (urlParams.has('density_min')) filtersState.density.min = Number(urlParams.get('density_min'));
                    if (urlParams.has('density_max')) filtersState.density.max = Number(urlParams.get('density_max'));
                    if (urlParams.has('price_min')) filtersState.price.min = Number(urlParams.get('price_min'));
                    if (urlParams.has('price_max')) filtersState.price.max = Number(urlParams.get('price_max'));
                    if (urlParams.has('status')) filtersState.status = urlParams.get('status').split(',');
                    if (urlParams.has('page')) currentPage = Number(urlParams.get('page')) || 1;

                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UI –∏–∑ state (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤)
                    restoreFiltersUI();
                }

                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ state
                function restoreFiltersUI() {
                    // –¶–≤–µ—Ç
                    if (filtersState.color) {
                        const swatch = document.querySelector(`#filterColors [data-color="${filtersState.color}"]`);
                        if (swatch) swatch.classList.add('active');
                    }

                    // –¢–∏–ø —Ç–∫–∞–Ω–∏
                    if (filtersState.fabricType) {
                        const btn = document.querySelector(`#filterFabricType [data-fabric-type="${filtersState.fabricType}"]`);
                        if (btn) {
                            document.querySelectorAll('#filterFabricType .filter-btn').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                        }
                    }

                    // –°–æ—Å—Ç–∞–≤
                    filtersState.composition.forEach(comp => {
                        const checkbox = document.querySelector(`#filterComposition input[value="${comp}"]`);
                        if (checkbox) checkbox.checked = true;
                    });

                    // –ü–ª–æ—Ç–Ω–æ—Å—Ç—å
                    if (filtersState.density.min !== null) {
                        const densityMin = document.getElementById('densityMin');
                        const sliderMin = document.getElementById('densitySliderMin');
                        if (densityMin) densityMin.value = filtersState.density.min;
                        if (sliderMin) sliderMin.value = filtersState.density.min;
                    }
                    if (filtersState.density.max !== null) {
                        const densityMax = document.getElementById('densityMax');
                        const sliderMax = document.getElementById('densitySliderMax');
                        if (densityMax) densityMax.value = filtersState.density.max;
                        if (sliderMax) sliderMax.value = filtersState.density.max;
                    }

                    // –¶–µ–Ω–∞
                    if (filtersState.price.min !== null) {
                        const priceMin = document.getElementById('priceMin');
                        const sliderMin = document.getElementById('priceSliderMin');
                        if (priceMin) priceMin.value = filtersState.price.min;
                        if (sliderMin) sliderMin.value = filtersState.price.min;
                    }
                    if (filtersState.price.max !== null) {
                        const priceMax = document.getElementById('priceMax');
                        const sliderMax = document.getElementById('priceSliderMax');
                        if (priceMax) priceMax.value = filtersState.price.max;
                        if (sliderMax) sliderMax.value = filtersState.price.max;
                    }

                    // –°—Ç–∞—Ç—É—Å
                    filtersState.status.forEach(status => {
                        const checkbox = document.querySelector(`#filterStatus input[value="${status}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }

                // ============================================
                // –°–ë–†–û–° –§–ò–õ–¨–¢–†–û–í
                // ============================================
                function resetFilters() {
                    // –û—á–∏—â–∞–µ–º state
                    filtersState.color = null;
                    filtersState.fabricType = null;
                    filtersState.composition = [];
                    filtersState.density = { min: null, max: null };
                    filtersState.price = { min: null, max: null };
                    filtersState.status = [];

                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∏—Å–∫
                    searchResults = null;

                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
                    currentPage = 1;

                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º UI
                    document.querySelectorAll('#filterColors .color-swatch').forEach(s => s.classList.remove('active'));
                    document.querySelectorAll('#filterFabricType .filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.fabricType === 'all') btn.classList.add('active');
                    });
                    document.querySelectorAll('#filterComposition input[type="checkbox"]').forEach(cb => cb.checked = false);
                    document.querySelectorAll('#filterStatus input[type="checkbox"]').forEach(cb => cb.checked = false);

                    const densityMin = document.getElementById('densityMin');
                    const densityMax = document.getElementById('densityMax');
                    const priceMin = document.getElementById('priceMin');
                    const priceMax = document.getElementById('priceMax');
                    if (densityMin) densityMin.value = '';
                    if (densityMax) densityMax.value = '';
                    if (priceMin) priceMin.value = '';
                    if (priceMax) priceMax.value = '';

                    // –û–±–Ω–æ–≤–ª—è–µ–º URL
                    window.history.pushState({}, '', 'catalog.html');

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥
                    loadCatalog();
                }

                // ============================================
                // –ö–õ–ê–°–°–ò–ß–ï–°–ö–ê–Ø –ü–ê–ì–ò–ù–ê–¶–ò–Ø
                // ============================================
                function renderPagination() {
                    const paginationContainer = document.getElementById('catalogPagination');
                    const paginationPages = document.getElementById('paginationPages');
                    const paginationPrev = document.getElementById('paginationPrev');
                    const paginationNext = document.getElementById('paginationNext');

                    if (!paginationContainer || !paginationPages || !paginationPrev || !paginationNext) {
                        console.error('[PAGINATION ERROR] –≠–ª–µ–º–µ–Ω—Ç—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', {
                            container: !!paginationContainer,
                            pages: !!paginationPages,
                            prev: !!paginationPrev,
                            next: !!paginationNext
                        });
                        return;
                    }

                    // –û–¢–õ–ê–î–ö–ê: –ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —É—Å–ª–æ–≤–∏–µ–º
                    console.log('[PAGINATION RENDER] –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π:', {
                        totalPages,
                        totalItems,
                        perPage,
                        condition: totalPages <= 1,
                        shouldShow: totalPages > 1
                    });

                    // –ö–ê–ù–û–ù–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û: –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –¢–û–õ–¨–ö–û –æ—Ç totalItems –∏ perPage
                    // –ù–ï –æ—Ç items.length (–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫)
                    // –ï–î–ò–ù–°–¢–í–ï–ù–ù–û –î–û–ü–£–°–¢–ò–ú–û–ï –£–°–õ–û–í–ò–ï: totalPages > 1 –ò–õ–ò totalItems > perPage
                    const shouldShowPagination = totalPages > 1;

                    // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê
                    console.log('[PAGINATION RENDER] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:', {
                        totalItems,
                        perPage,
                        totalPages,
                        calculation: `Math.ceil(${totalItems} / ${perPage}) = ${totalPages}`,
                        shouldShow: shouldShowPagination,
                        rule: 'totalPages > 1 (–ù–ï items.length)',
                        warning: 'items.length –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –æ –ø–æ–∫–∞–∑–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏'
                    });

                    // –ü–†–ê–í–ò–õ–û: –ü–∞–≥–∏–Ω–∞—Ü–∏—è –°–ö–†–´–í–ê–ï–¢–°–Ø, –µ—Å–ª–∏ totalPages <= 1
                    // –ü–†–ê–í–ò–õ–û: –ü–∞–≥–∏–Ω–∞—Ü–∏—è –û–¢–û–ë–†–ê–ñ–ê–ï–¢–°–Ø, –µ—Å–ª–∏ totalPages > 1
                    if (!shouldShowPagination) {
                        paginationContainer.style.display = 'none';
                        paginationContainer.style.visibility = 'hidden';
                        console.log('[PAGINATION] ‚ùå –°–ö–†–´–¢–ê: totalPages <= 1', {
                            totalPages,
                            totalItems,
                            perPage,
                            reason: 'totalPages <= 1 (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)'
                        });
                        return;
                    }

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é - –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û
                    paginationContainer.style.display = 'flex';
                    paginationContainer.style.visibility = 'visible';
                    paginationContainer.style.opacity = '1';
                    console.log('[PAGINATION] ‚úÖ –û–¢–û–ë–†–ê–ñ–ê–ï–¢–°–Ø', {
                        totalPages,
                        totalItems,
                        perPage,
                        currentPage,
                        containerFound: !!paginationContainer,
                        containerDisplay: window.getComputedStyle(paginationContainer).display
                    });
                    paginationPages.innerHTML = '';

                    // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
                    paginationPrev.disabled = currentPage === 1;
                    paginationPrev.setAttribute('aria-label', '–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞');
                    paginationPrev.onclick = () => {
                        if (currentPage > 1) {
                            currentPage--;
                            updateURL();
                            scrollToCatalogTop();
                            loadCatalog();
                        }
                    };

                    // –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
                    const maxVisible = 5;
                    let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
                    let endPage = Math.min(totalPages, startPage + maxVisible - 1);

                    if (endPage - startPage < maxVisible - 1) {
                        startPage = Math.max(1, endPage - maxVisible + 1);
                    }

                    for (let i = startPage; i <= endPage; i++) {
                        const pageBtn = document.createElement('button');
                        pageBtn.className = 'pagination-page';
                        pageBtn.type = 'button';
                        pageBtn.textContent = i;

                        if (i === currentPage) {
                            pageBtn.classList.add('active');
                            pageBtn.setAttribute('aria-current', 'page');
                            pageBtn.disabled = true;
                        } else {
                            pageBtn.onclick = () => {
                                currentPage = i;
                                updateURL();
                                scrollToCatalogTop();
                                loadCatalog();
                            };
                        }

                        paginationPages.appendChild(pageBtn);
                    }

                    // –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä—ë–¥"
                    paginationNext.disabled = currentPage >= totalPages;
                    paginationNext.setAttribute('aria-label', '–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞');
                    paginationNext.onclick = () => {
                        if (currentPage < totalPages) {
                            currentPage++;
                            updateURL();
                            scrollToCatalogTop();
                            loadCatalog();
                        }
                    };
                }

                // –°–∫—Ä–æ–ª–ª –∫ –Ω–∞—á–∞–ª—É –∫–∞—Ç–∞–ª–æ–≥–∞
                function scrollToCatalogTop() {
                    const catalogPage = document.querySelector('.catalog-page');
                    if (catalogPage) {
                        catalogPage.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }

                // ============================================
                // –†–ï–ù–î–ï–† –ö–ê–¢–ê–õ–û–ì–ê
                // ============================================
                function renderCatalog(products) {
                    if (!products || products.length === 0) {
                        catalogGrid.innerHTML = '<div class="catalog-empty">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                        return;
                    }

                    catalogGrid.innerHTML = '';

                    products.forEach(product => {
                        const adaptedProduct = {
                            ...product,
                            productId: product.productId || product.id,
                            isNew: product.is_new || product.isNew,
                            isComing: product.coming_soon || product.isComing,
                            status: product.is_new ? 'new' : (product.coming_soon ? 'coming' : ''),
                            currency: product.price_unit || '‚ÇΩ',
                            oldPrice: product.old_price || product.oldPrice,
                            newPrice: product.price
                        };

                        const card = CatalogProductCard.render(adaptedProduct);
                        if (card) {
                            catalogGrid.appendChild(card);
                        }
                    });
                }

                // ============================================
                // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–†–¢–ò–†–û–í–ö–ò
                // ============================================
                sortSelect.addEventListener('change', () => {
                    // –°–ë–†–û–° –ü–ê–ì–ò–ù–ê–¶–ò–ò –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                    currentPage = 1;
                    updateURL();
                    loadCatalog();
                });

                // ============================================
                // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ë–ï–ô–î–ñ–ê –ö–û–†–ó–ò–ù–´
                // ============================================
                function updateCartBadge() {
                    const badge = document.getElementById('cartBadge');
                    if (badge && typeof CartStore !== 'undefined') {
                        const count = CartStore.getCount();
                        badge.textContent = count;
                        badge.classList.toggle('hidden', count === 0);
                    }
                }

                updateCartBadge();
                if (typeof CartStore !== 'undefined') {
                    document.addEventListener('cart:updated', updateCartBadge);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞:', error);
                const catalogGrid = document.getElementById('catalogGrid');
                if (catalogGrid) {
                    catalogGrid.innerHTML = `
                        <div class="catalog-error" style="padding: 40px; text-align: center; color: #d32f2f;">
                            <h2>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞</h2>
                            <p>${error.message}</p>
                            <p style="margin-top: 20px; font-size: 14px; color: #666;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.</p>
                        </div>
                    `;
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è —à–∞–ø–∫–∏ (–∫–∞–∫ –Ω–∞ FAQ)
        document.addEventListener('DOMContentLoaded', () => {
            const headerSticky = document.getElementById('headerSticky');
            if (headerSticky) {
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 60) {
                        headerSticky.classList.add('scrolled');
                    } else {
                        headerSticky.classList.remove('scrolled');
                    }
                }, { passive: true });
            }
        });
    </script>
    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π –∫–∞—Ç–∞–ª–æ–≥–∞ -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // SearchController –∏ SEOController –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ç–∞–ª–æ–≥–∞
            if (window.SearchController) {
                SearchController.init({
                    inputSelector: '.search-input',
                    debounceDelay: 300,
                    minQueryLength: 2
                });
            }
            if (window.SEOController) {
                SEOController.init({ siteName: 'BazarBuy' });
            }
        });
    </script>

    <!-- Cabinet Scripts -->
    <script type="module" src="cabinet/cabinet-api.js"></script>
    <script type="module" src="cabinet/cabinet-store.js"></script>
    <script type="module" src="cabinet/cabinet.js"></script>

    <!-- WordPress Data Source Activation (TEST MODE) -->
    <script>
        console.log('[TEST] Switching to WordPress data source');

        if (window.WordPressRESTSource && window.CatalogDataStore) {
            WordPressRESTSource.configure({
                baseURL: '/wp-json/wc/v3',
                productsEndpoint: '/products'
            });

            CatalogDataStore.setDataSource(WordPressRESTSource);
            console.log('[TEST] WordPressRESTSource ENABLED');
        } else {
            console.error('[TEST] WordPressRESTSource NOT FOUND');
        }
    </script>
</body>

</html>