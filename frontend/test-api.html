<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #fff3cd; color: #856404; }
        .product { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Bazar Buy</h1>
    <div id="status" class="status loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div id="products"></div>

    <!-- API Modules -->
    <script type="module" src="js/api/client.js"></script>
    <script type="module" src="js/api/products.js"></script>
    <script type="module" src="js/api/index.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const statusDiv = document.getElementById('status');
            const productsDiv = document.getElementById('products');

            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –º–æ–¥—É–ª–µ–π
                if (typeof ProductsAPI === 'undefined') {
                    throw new Error('ProductsAPI –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }

                statusDiv.textContent = 'API –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∑–∞–ø—Ä–æ—Å —Ç–æ–≤–∞—Ä–æ–≤...';
                
                // –ó–∞–ø—Ä–æ—Å —Ç–æ–≤–∞—Ä–æ–≤
                const result = await ProductsAPI.getProducts({ limit: 5 });
                
                if (!result.success) {
                    throw new Error('API –æ—à–∏–±–∫–∞: ' + result.error);
                }

                const products = result.data.products || result.data;
                statusDiv.className = 'status success';
                statusDiv.textContent = `‚úÖ –£—Å–ø–µ—à–Ω–æ! –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${products.length} —Ç–æ–≤–∞—Ä–æ–≤`;

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
                productsDiv.innerHTML = products.map(product => `
                    <div class="product">
                        <h3>${product.name}</h3>
                        <p><strong>–¶–µ–Ω–∞:</strong> ${product.price} ‚ÇΩ</p>
                        <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${product.category?.name || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                        <p><strong>–¶–≤–µ—Ç:</strong> ${product.color || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                        <p><strong>–í –Ω–∞–ª–∏—á–∏–∏:</strong> ${product.warehouseAvailability} –º</p>
                        ${product.isOnSale ? '<p style="color: red;">üî• –°–ö–ò–î–ö–ê</p>' : ''}
                        ${product.isNew ? '<p style="color: green;">‚ú® –ù–û–í–ò–ù–ö–ê</p>' : ''}
                    </div>
                `).join('');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
                productsDiv.innerHTML = `
                    <h3>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:</h3>
                    <ul>
                        <li>ApiClient –¥–æ—Å—Ç—É–ø–µ–Ω: ${typeof ApiClient !== 'undefined' ? '‚úÖ' : '‚ùå'}</li>
                        <li>ProductsAPI –¥–æ—Å—Ç—É–ø–µ–Ω: ${typeof ProductsAPI !== 'undefined' ? '‚úÖ' : '‚ùå'}</li>
                        <li>Backend –¥–æ—Å—Ç—É–ø–µ–Ω: –ø—Ä–æ–≤–µ—Ä—è–µ–º...</li>
                    </ul>
                    <div id="backendStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞ backend...</div>
                `;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ backend
                try {
                    const response = await fetch('http://localhost:3000/api/v1/products?limit=1');
                    const data = await response.json();
                    document.getElementById('backendStatus').innerHTML = 
                        response.ok ? '‚úÖ Backend –æ—Ç–≤–µ—á–∞–µ—Ç' : '‚ùå Backend –æ—à–∏–±–∫–∞: ' + data.error;
                } catch (backendError) {
                    document.getElementById('backendStatus').innerHTML = '‚ùå Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + backendError.message;
                }
            }
        });
    </script>
</body>
</html>